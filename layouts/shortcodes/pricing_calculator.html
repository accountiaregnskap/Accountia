{{ $lang := site.Language.Lang }}
<div class="ac-calc" data-lang="{{ $lang }}">
  <div class="ac-calc-grid">
    <!-- LEFT: Inputs -->
    <div class="ac-calc-card">
      <h2 class="ac-calc-title">{{ if eq $lang "no" }}Valg{{ else if eq $lang "en" }}Inputs{{ else if eq $lang "es" }}Opciones{{ else if eq $lang "ar" }}الخيارات{{ else }}Inputs{{ end }}</h2>

      <label class="ac-label" for="companyType">{{ if eq $lang "no" }}Selskapsform{{ else if eq $lang "en" }}Company type{{ else if eq $lang "es" }}Tipo de empresa{{ else if eq $lang "ar" }}نوع الشركة{{ else }}Company type{{ end }}</label>
      <select class="ac-select" id="companyType">
        <option value="ENK" selected>{{ if eq $lang "no" }}ENK (Enkeltpersonforetak){{ else if eq $lang "en" }}Sole Proprietorship (ENK){{ else if eq $lang "es" }}Autónomo (ENK){{ else if eq $lang "ar" }}مؤسسة فردية (ENK){{ else }}Sole Proprietorship (ENK){{ end }}</option>
        <option value="AS">{{ if eq $lang "no" }}AS (Aksjeselskap){{ else if eq $lang "en" }}Limited Company (AS){{ else if eq $lang "es" }}Sociedad limitada (AS){{ else if eq $lang "ar" }}شركة محدودة (AS){{ else }}Limited Company (AS){{ end }}</option>
      </select>

      <label class="ac-label" for="vouchers">{{ if eq $lang "no" }}Bilag per måned{{ else if eq $lang "en" }}Vouchers per month{{ else if eq $lang "es" }}Comprobantes por mes{{ else if eq $lang "ar" }}المستندات شهريًا{{ else }}Vouchers per month{{ end }}</label>
      <select class="ac-select" id="vouchers"></select>
      <div class="ac-help" id="vHelp">{{ if eq $lang "no" }}Velg “0” hvis du ikke vil beregne pris ennå.{{ else if eq $lang "en" }}Choose “0” if you’re not ready to estimate yet.{{ else if eq $lang "es" }}Elige “0” si aún no quieres calcular el precio.{{ else if eq $lang "ar" }}اختر “0” إذا لم ترغب بحساب السعر الآن.{{ else }}Choose “0” if you’re not ready to estimate yet.{{ end }}</div>

      <label class="ac-label" for="vat">{{ if eq $lang "no" }}MVA-registrert{{ else if eq $lang "en" }}VAT registered{{ else if eq $lang "es" }}Registrado en IVA{{ else if eq $lang "ar" }}مسجل لضريبة القيمة المضافة{{ else }}VAT registered{{ end }}</label>
      <select class="ac-select" id="vat">
        <option value="no" selected>{{ if eq $lang "no" }}Nei{{ else if eq $lang "en" }}No{{ else if eq $lang "es" }}No{{ else if eq $lang "ar" }}لا{{ else }}No{{ end }}</option>
        <option value="yes">{{ if eq $lang "no" }}Ja{{ else if eq $lang "en" }}Yes{{ else if eq $lang "es" }}Sí{{ else if eq $lang "ar" }}نعم{{ else }}Yes{{ end }}</option>
      </select>

      <label class="ac-label" for="employees">{{ if eq $lang "no" }}Antall ansatte{{ else if eq $lang "en" }}Employees{{ else if eq $lang "es" }}Empleados{{ else if eq $lang "ar" }}عدد الموظفين{{ else }}Employees{{ end }}</label>
      <select class="ac-select" id="employees">
        <option value="0" selected>{{ if eq $lang "no" }}0 (Ingen){{ else if eq $lang "en" }}0 (None){{ else if eq $lang "es" }}0 (None){{ else if eq $lang "ar" }}0 (None){{ else }}0 (None){{ end }}</option>
        <option value="1">1</option>
        <option value="2-3">2–3</option>
        <option value="4-6">4–6</option>
        <option value="7-9">7–9</option>
        <option value="10-15">10–15</option>
        <option value="15+">15+</option>
      </select>

      <label class="ac-label" id="annualLabel" for="annualAddon"></label>
      <select class="ac-select" id="annualAddon">
        <option value="no" selected>{{ if eq $lang "no" }}Nei{{ else if eq $lang "en" }}No{{ else if eq $lang "es" }}No{{ else if eq $lang "ar" }}لا{{ else }}No{{ end }}</option>
        <option value="yes">{{ if eq $lang "no" }}Ja{{ else if eq $lang "en" }}Yes{{ else if eq $lang "es" }}Sí{{ else if eq $lang "ar" }}نعم{{ else }}Yes{{ end }}</option>
      </select>
      <div class="ac-help" id="annualHelp"></div>
    </div>

    <!-- RIGHT: Summary -->
    <div class="ac-calc-card">
      <h2 class="ac-calc-title" style="margin:0 0 12px;">{{ if eq $lang "no" }}Oppsummering{{ else if eq $lang "en" }}Summary{{ else if eq $lang "es" }}Summary{{ else if eq $lang "ar" }}Summary{{ else }}Summary{{ end }}</h2>

      <div class="ac-summary">
        <div class="ac-srow"><span>{{ if eq $lang "no" }}Selskapsform{{ else if eq $lang "en" }}Company type{{ else if eq $lang "es" }}Tipo de empresa{{ else if eq $lang "ar" }}نوع الشركة{{ else }}Company type{{ end }}</span><strong id="sCompany">—</strong></div>
        <div class="ac-srow"><span>{{ if eq $lang "no" }}Bilag{{ else if eq $lang "en" }}Vouchers{{ else if eq $lang "es" }}Comprobantes{{ else if eq $lang "ar" }}مستندات{{ else }}Vouchers{{ end }}</span><strong id="sVouchers">—</strong></div>
        <div class="ac-srow"><span>{{ if eq $lang "no" }}MVA{{ else if eq $lang "en" }}VAT{{ else if eq $lang "es" }}VAT{{ else if eq $lang "ar" }}VAT{{ else }}VAT{{ end }}</span><strong id="sVat">—</strong></div>
        <div class="ac-srow"><span>{{ if eq $lang "no" }}Ansatte{{ else if eq $lang "en" }}Employees{{ else if eq $lang "es" }}Employees{{ else if eq $lang "ar" }}Employees{{ else }}Employees{{ end }}</span><strong id="sEmp">—</strong></div>
        <div class="ac-srow"><span id="sAnnualName">{{ if eq $lang "no" }}Årlig tjeneste{{ else if eq $lang "en" }}Annual service{{ else if eq $lang "es" }}Annual service{{ else if eq $lang "ar" }}Annual service{{ else }}Annual service{{ end }}</span><strong id="sAnnual">—</strong></div>

        <hr class="ac-hr" />

        <div class="ac-srow ac-big"><span>{{ if eq $lang "no" }}Månedspris{{ else if eq $lang "en" }}Monthly fee{{ else if eq $lang "es" }}Monthly fee{{ else if eq $lang "ar" }}Monthly fee{{ else }}Monthly fee{{ end }}</span><strong id="outMonthly">—</strong></div>
        <div class="ac-srow"><span>{{ if eq $lang "no" }}Årlige tillegg{{ else if eq $lang "en" }}Annual add-ons{{ else if eq $lang "es" }}Annual add-ons{{ else if eq $lang "ar" }}Annual add-ons{{ else }}Annual add-ons{{ end }}</span><strong id="outAnnual">—</strong></div>
        <div class="ac-srow ac-big"><span>{{ if eq $lang "no" }}Total årskostnad{{ else if eq $lang "en" }}Total annual cost{{ else if eq $lang "es" }}Total annual cost{{ else if eq $lang "ar" }}Total annual cost{{ else }}Total annual cost{{ end }}</span><strong id="outTotalAnnual">—</strong></div>

        <div class="ac-note" id="outNote"></div>

        <div class="ac-srow" style="margin-top:14px;">
          <span>{{ if eq $lang "no" }}Rådgivningstime{{ else if eq $lang "en" }}Advisory hourly rate{{ else if eq $lang "es" }}Hora de asesoría{{ else if eq $lang "ar" }}ساعة استشارة{{ else }}Advisory hourly rate{{ end }}</span><strong id="outAdvisory">—</strong>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .ac-calc { margin-top: 16px; }
  .ac-calc-grid{ display:grid; grid-template-columns: 1fr 1fr; gap: 16px; align-items:start; }
  .ac-calc-card{
    background: rgba(255,255,255,0.98);
    border: 1px solid rgba(17,24,39,0.12);
    border-radius: 16px;
    padding: 16px;
    box-shadow: 0 10px 30px rgba(0,0,0,0.06);
  }
  .ac-calc-title{ font-size: 20px; margin: 0 0 12px; color:#111827; }
  .ac-label{ display:block; font-weight:700; margin: 12px 0 6px; color:#111827; }
  .ac-select{
    width:100%; min-height: 44px; border-radius: 12px;
    border: 1px solid rgba(17,24,39,0.18); padding: 10px 12px;
    background:#fff; font-size: 15px; outline:none;
  }
  .ac-select:focus{ border-color: rgba(212,165,116,0.9); box-shadow: 0 0 0 3px rgba(212,165,116,0.18); }
  .ac-help{ font-size: 12px; color: rgba(17,24,39,0.65); margin-top: 6px; }
  .ac-summary{ margin-top: 6px; }
  .ac-srow{
    display:flex; justify-content:space-between; gap: 10px; padding: 10px 0;
    border-bottom: 1px dashed rgba(17,24,39,0.14); color:#111827;
  }
  .ac-srow strong{ font-weight:800; }
  .ac-hr{ border:0; border-top:1px solid rgba(17,24,39,0.12); margin: 14px 0; }
  .ac-big span{ font-weight:800; }
  .ac-big strong{ font-size: 18px; }
  .ac-note{
    margin-top: 12px; padding: 10px 12px; border-radius: 12px;
    background: rgba(11,18,32,0.06); color: rgba(17,24,39,0.75); font-size: 13px;
  }
  @media (max-width: 900px){ .ac-calc-grid{ grid-template-columns: 1fr; } }
</style>

<script>
(function(){
  const root = document.querySelector(".ac-calc[data-lang]");
  if(!root) return;
  const lang = root.getAttribute("data-lang") || "no";

  const T = (no, en) => (lang === "no" ? no : en);

  const VAT_ADDON_MONTHLY = 700;
  const ADVISORY_HOURLY = 899;
  const ENK_TAX_RETURN_ANNUAL = 4999;
  const AS_FIN_STMT_ANNUAL = 7999;

  const BASE = {
    ENK: [
      { key:"0", label:T("0 (Ikke klar)", "0 (Not ready)"), price:null },
      { key:"1-10", label:"1–10", price:2990 },
      { key:"11-25", label:"11–25", price:3490 },
      { key:"26-40", label:"26–40", price:3990 },
      { key:"40+", label:T("40+ (Kontakt oss)", "40+ (Contact us)"), price:"contact" }
    ],
    AS: [
      { key:"0", label:T("0 (Ikke klar)", "0 (Not ready)"), price:null },
      { key:"1-15", label:"1–15", price:3990 },
      { key:"16-40", label:"16–40", price:4990 },
      { key:"41-80", label:"41–80", price:5990 },
      { key:"80+", label:T("80+ (Kontakt oss)", "80+ (Contact us)"), price:"contact" }
    ]
  };

  const EMP_ADDON = {
    "0": 0,
    "1": 390,
    "2-3": 690,
    "4-6": 1100,
    "7-9": 1490,
    "10-15": 2250,
    "15+": "contact"
  };

  const $ = (id) => document.getElementById(id);

  const elCompany = $("companyType");
  const elVouchers = $("vouchers");
  const elVat = $("vat");
  const elEmp = $("employees");
  const elAnnual = $("annualAddon");
  const elAnnualLabel = $("annualLabel");
  const elAnnualHelp = $("annualHelp");

  function money(n){
    if (typeof n !== "number") return n;
    return new Intl.NumberFormat(lang === "no" ? "nb-NO" : "en-US", {
      style:"currency", currency:"NOK", maximumFractionDigits: 0
    }).format(n);
  }

  function setVoucherOptions(company){
    elVouchers.innerHTML = "";
    BASE[company].forEach(opt => {
      const o = document.createElement("option");
      o.value = opt.key;
      o.textContent = opt.label;
      elVouchers.appendChild(o);
    });
    elVouchers.value = "0";
  }

  function updateAnnualUI(company){
    if (company === "ENK"){
      elAnnualLabel.textContent = T("Skattemelding (årlig)", "Annual tax return");
      elAnnualHelp.textContent = T("Valgfritt årlig tillegg for ENK.", "Optional annual service for ENK.");
      $("sAnnualName").textContent = T("Skattemelding", "Tax return");
    } else {
      elAnnualLabel.textContent = T("Årsregnskap (årlig)", "Annual financial statements");
      elAnnualHelp.textContent = T("Valgfritt årlig tillegg for AS.", "Optional annual service for AS.");
      $("sAnnualName").textContent = T("Årsregnskap", "Financial statements");
    }
    elAnnual.value = "no";
  }

  function getBasePrice(company, voucherKey){
    const opt = BASE[company].find(x => x.key === voucherKey);
    return opt ? opt.price : "contact";
  }

  function compute(){
    const company = elCompany.value;
    const voucherKey = elVouchers.value;
    const vat = elVat.value;
    const empKey = elEmp.value;
    const annualYes = elAnnual.value === "yes";

    $("sCompany").textContent = company;
    $("sVouchers").textContent = voucherKey;
    $("sVat").textContent = (vat === "yes")
      ? T("MVA-registrert", "VAT registered")
      : T("Ikke MVA-registrert", "Not VAT registered");
    $("sEmp").textContent = empKey;

    $("outAdvisory").textContent = money(ADVISORY_HOURLY) + T(" / time", " / hour");

    const basePrice = getBasePrice(company, voucherKey);

    if (voucherKey === "0"){
      $("outMonthly").textContent = "—";
      $("outAnnual").textContent = "—";
      $("outTotalAnnual").textContent = "—";
      $("sAnnual").textContent = annualYes ? T("Ja", "Yes") : T("Nei", "No");
      $("outNote").textContent = T("Velg bilagsintervall for å få et estimat.", "Select your voucher range to get an estimate.");
      return;
    }

    if (basePrice === "contact" || EMP_ADDON[empKey] === "contact"){
      $("outMonthly").textContent = T("Kontakt oss", "Contact us");
      $("outAnnual").textContent = T("Kontakt oss", "Contact us");
      $("outTotalAnnual").textContent = T("Kontakt oss", "Contact us");
      $("sAnnual").textContent = annualYes ? T("Ja", "Yes") : T("Nei", "No");
      $("outNote").textContent = T(
        "Valget er utenfor standardpakkene. Kontakt oss for et skreddersydd tilbud.",
        "Your selection is outside the standard packages. Contact us for a tailored quote."
      );
      return;
    }

    const vatAddon = (vat === "yes") ? VAT_ADDON_MONTHLY : 0;
    const empAddon = EMP_ADDON[empKey];

    const monthly = basePrice + vatAddon + empAddon;

    let annualAddon = 0;
    if (company === "ENK" && annualYes) annualAddon += ENK_TAX_RETURN_ANNUAL;
    if (company === "AS" && annualYes) annualAddon += AS_FIN_STMT_ANNUAL;

    const totalAnnual = (monthly * 12) + annualAddon;

    $("sAnnual").textContent = annualYes ? T("Ja", "Yes") : T("Nei", "No");
    $("outMonthly").textContent = money(monthly) + T(" / mnd", " / month");
    $("outAnnual").textContent = money(annualAddon) + T(" / år", " / year");
    $("outTotalAnnual").textContent = money(totalAnnual) + T(" / år", " / year");
    $("outNote").textContent = T(
      "Estimater basert på standardpakker. Endelig pris kan variere med kompleksitet og omfang.",
      "Estimates are based on standard packages. Final pricing may vary depending on complexity and scope."
    );
  }

  setVoucherOptions(elCompany.value);
  updateAnnualUI(elCompany.value);
  compute();

  elCompany.addEventListener("change", () => {
    setVoucherOptions(elCompany.value);
    updateAnnualUI(elCompany.value);
    compute();
  });

  [elVouchers, elVat, elEmp, elAnnual].forEach(el => el.addEventListener("change", compute));
})();
</script>
