{{/*
  Build language switch links:
  - Prefer current page translation if it exists
  - Fallback to language homepage
*/}}
{{ $cur := . }}
{{ $homeLinks := dict }}
{{ range site.Home.AllTranslations }}
  {{ $homeLinks = merge $homeLinks (dict .Lang .RelPermalink) }}
{{ end }}
{{ $homeLinks = merge $homeLinks (dict site.Home.Lang site.Home.RelPermalink) }}

<header class="site-header">
  <div class="header-inner">


    <a class="brand brand-stack brand-image" href="{{ "/" | relLangURL }}" aria-label="Accountia">
      
      <img class="brand-img" src="{{ "images/accountia_logo_horizontal.png" | relURL }}" alt="Accountia Regnskap">

    </a>


    <!-- Mobil meny-toggle -->
    <input class="nav-toggle" type="checkbox" id="nav-toggle" aria-label="{{ if eq site.Language.Lang "en" }}Open menu{{ else }}Ã…pne meny{{ end }}">

    <label class="nav-toggle-btn" for="nav-toggle">
      <span></span>
      <span></span>
      <span></span>
      <span class="menu-text">{{ if eq site.Language.Lang "en" }}Menu{{ else }}Meny{{ end }}</span>
    </label>

    <nav class="nav" role="navigation">
      {{ range site.Menus.main }}
        <a class="nav-link {{ if $.IsMenuCurrent "main" . }}active{{ end }}" href="{{ .URL }}">
          {{ .Name }}
        </a>
      {{ end }}

      {{/* Language dropdown: go to the same page in the chosen language when possible */}}
      {{ $cur := . }}
      {{ $home := site.Home }}
      {{ $homeLinks := dict }}
      {{ range $home.AllTranslations }}
        {{ $homeLinks = merge $homeLinks (dict .Lang .RelPermalink) }}
      {{ end }}
      {{ $homeLinks = merge $homeLinks (dict $home.Lang $home.RelPermalink) }}

      <div class="lang-dd">
        <details>
          <summary>{{ i18n "lang_label" }}: {{ upper site.Language.Lang }}</summary>
          <div class="lang-dd-menu">
            {{ range site.Languages }}
              {{ $lang := .Lang }}
              {{ $url := (index $homeLinks $lang) }}
              {{ range $cur.AllTranslations }}
                {{ if eq .Lang $lang }}{{ $url = .RelPermalink }}{{ end }}
              {{ end }}
              {{ if eq $cur.Lang $lang }}{{ $url = $cur.RelPermalink }}{{ end }}
              <a class="lang-item {{ if eq site.Language.Lang $lang }}active{{ end }}" href="{{ $url }}">{{ upper $lang }}</a>
            {{ end }}
          </div>
        </details>
      </div>
    </nav>
  </div>
</header>
